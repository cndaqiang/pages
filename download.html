<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ä¸‹è½½ autowzry-cli æœ€æ–°ç‰ˆæœ¬</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  text-align: center;
  margin-top: 50px;
  background: #f0f2f5;
  padding: 0 10px; /* å°å±ç•™è¾¹ */
}
h2 {
  color: #333;
  margin-bottom: 30px;
}

/* æŒ‰é’®æ ·å¼ */
.button {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #28a745; /* ä¸‹è½½æŒ‰é’®ç»¿è‰² */
  color: white;
  border: none;
  padding: 14px 24px;
  font-size: 16px;
  border-radius: 10px;
  cursor: pointer;
  margin: 10px auto;
  width: 90%;         /* å“åº”å¼å®½åº¦ */
  max-width: 400px;   /* å¤§å±é™åˆ¶ */
  min-width: 200px;   /* å°å±é™åˆ¶ */
  text-align: left;
  gap: 10px;
  transition: all 0.2s;
}
.button:hover {
  opacity: 0.9;
}

/* ä¸åŒç”¨é€”çš„æŒ‰é’®é¢œè‰² */
.button-src { background-color: #fd7e14; }   /* æ©™è‰² */
.button-tutorial { background-color: #007bff; } /* è“è‰² */

/* ä¸‹è½½è¿›åº¦æ¡ */
#progressContainer {
  width: 90%;
  max-width: 400px;
  min-width: 200px;
  height: 20px;
  background: #ddd;
  border-radius: 10px;
  margin: 10px auto 20px auto;
  overflow: hidden;
}
#progressBar {
  height: 100%;
  width: 0%;
  background: #0078d7;
  border-radius: 10px;
  transition: width 0.2s;
}
#status {
  font-size: 14px;
  color: #333;
  margin-top: 5px;
}

/* å°å±ä¼˜åŒ–å­—ä½“ */
@media (max-width: 400px) {
  .button {
    font-size: 14px;
    padding: 12px 18px;
  }
  #status {
    font-size: 12px;
  }
}
</style>
</head>
<body>
<h2>ä¸‹è½½ autowzry-cli æœ€æ–°ç‰ˆæœ¬</h2>

<!-- Windows ä¸‹è½½ -->
<button id="downloadWin" class="button">ğŸ–¥ï¸ ä¸‹è½½å¯æ‰§è¡ŒåŒ… Windows </button>
<div id="progressContainer"><div id="progressBar"></div></div>
<div id="status">å‡†å¤‡ä¸‹è½½...</div>

<!-- Linux/macOS æºç  -->
<button id="downloadSrc" class="button button-src">ğŸ§ ä¸‹è½½æºç  Linux/macOS  </button>

<!-- æ•™ç¨‹æŒ‰é’® -->
<button id="tutorial1" class="button button-tutorial">ğŸ“˜ Windowsç³»ç»Ÿæ•™ç¨‹</button>
<button id="tutorial2" class="button button-tutorial">ğŸ“— æºä»£ç è¿è¡Œæ•™ç¨‹</button>

<script>
// âœ… ä¸‹è½½å¸¦è¿›åº¦æ¡
async function downloadWithProgress(url, filename) {
  const status = document.getElementById('status');
  const progressBar = document.getElementById('progressBar');
  status.textContent = 'å¼€å§‹ä¸‹è½½...';
  progressBar.style.width = '0%';

  const resp = await fetch(url);
  if (!resp.ok) throw new Error('ä¸‹è½½å¤±è´¥');

  const contentLength = resp.headers.get('Content-Length');
  const total = contentLength ? parseInt(contentLength, 10) : 0;

  const reader = resp.body.getReader();
  const chunks = [];
  let received = 0;

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    chunks.push(value);
    received += value.length;
    if (total) {
      const percent = ((received / total) * 100).toFixed(1);
      status.textContent = `ä¸‹è½½ä¸­ï¼š${percent}%`;
      progressBar.style.width = `${percent}%`;
    } else {
      status.textContent = `ä¸‹è½½ä¸­ï¼š${(received / 1024).toFixed(1)} KB`;
    }
  }

  const blob = new Blob(chunks);
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);

  status.textContent = 'ä¸‹è½½å®Œæˆï¼';
  progressBar.style.width = '100%';
}

// âœ… Windows ä¸‹è½½æŒ‰é’®
async function downloadWinLatest() {
  try {
    const resp = await fetch(`https://pypi.org/pypi/autowzry-cli/json?ts=${Date.now()}`, { cache: 'no-store' });
    const data = await resp.json();

    // æ‰¾ Windows amd64 wheel
    const file = data.urls.find(f => f.url.includes('win_amd64') && f.url.endsWith('.whl'));
    if (!file) {
      alert('æœªæ‰¾åˆ° Windows wheel');
      return;
    }

    const version = data.info.version;
    const filename = `autowzry-cli-${version}.zip`;

    await downloadWithProgress(file.url, filename);
  } catch (err) {
    console.error(err);
    alert('ä¸‹è½½å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•');
  }
}

// âœ… Linux/macOS æºç ä¸‹è½½ï¼ˆå›ºå®š URLï¼‰
function downloadSrc() {
  window.open("https://github.com/cndaqiang/autowzry/tree/dev", "_blank");
}

// âœ… æ•™ç¨‹è·³è½¬
function openTutorial1() {
  window.open("https://cndaqiang.github.io/wzry.doc/guide/install/", "_blank");
}
function openTutorial2() {
  window.open("https://cndaqiang.github.io/wzry.doc/guide/pyinstall/", "_blank");
}

// ç»‘å®šæŒ‰é’®
document.getElementById('downloadWin').addEventListener('click', downloadWinLatest);
document.getElementById('downloadSrc').addEventListener('click', downloadSrc);
document.getElementById('tutorial1').addEventListener('click', openTutorial1);
document.getElementById('tutorial2').addEventListener('click', openTutorial2);
</script>
</body>
</html>
